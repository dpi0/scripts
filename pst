#!/usr/bin/env bash

# Global variables
UPLOAD_URL="https://bin.dpi0.cloud"
FILEPATH="$1"

# Ensure a file is provided
if [[ -z "$FILEPATH" || ! -f "$FILEPATH" ]]; then
  echo "Error: Valid file required."
  echo "Usage: $0 /path/to/file"
  exit 1
fi

# Extract filename and extension
FILENAME="$(basename -- "$FILEPATH")"
EXTENSION="${FILENAME##*.}"

# Upload file
RESPONSE=$(curl --silent --fail --show-error --data-binary @"$FILEPATH" --url "$UPLOAD_URL")
[[ -z "$RESPONSE" || "$RESPONSE" == *"error"* ]] && {
  echo "Error: Upload failed."
  exit 1
}

# Construct file URL
FILE_URL="$UPLOAD_URL/p$RESPONSE.$EXTENSION"

# Copy URL to clipboard if available
command -v wl-copy &> /dev/null && echo "$FILE_URL" | wl-copy

# Show notification if available
command -v notify-send &> /dev/null && notify-send "âœ… Upload Successful" "URL copied: $FILE_URL"

# Output URL
echo "$FILE_URL"
